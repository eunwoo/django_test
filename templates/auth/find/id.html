<!-- Safety form page -->
{% extends 'base/head.html' %}
{% load static %}
{% block title %}
아이디 찾기
{% endblock %}
{% block style %}
<style>
  main {
    width: 70%;
    min-width: 1200px;
    margin: 20px auto;
  }
</style>
{% endblock %}

{% block content %}
{% include 'base/header.html' %}

<main>
  <div class="cont mt-4">
    <section>
      <br>
      <div class="container">
        <div class="row ml-0">
          <div class="col">
            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">아이디 / 비밀번호 찾기</a>
                </li>
                <li class="breadcrumb-item">아이디 찾기</a>
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </section>
    <section>
      <div class="container">
        <div class="row">
          <h1>아이디 찾기</h1>
        </div>
        <div class="row justify-content-center">
          <div class="col-lg-2">
            <label for="" class="col-12 text-center">성명</label>
          </div>
          <div class="col-lg-6">
            <input type="text" class="col-12 text-center" id="name" placeholder="성명을 입력해 주세요.">
          </div>
        </div>
        <div class="row mt-3 justify-content-center">
          <div class="col-lg-2">
            <label for="" class="col-12 text-center">전화번호</label>
          </div>
          <div class="col-lg-6">
            <input type="text" class="col-12 text-center" id="call" placeholder="전화번호를 입력해 주세요. ex) 010-1234-1234"
              pattern="[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}" maxlength="13">
          </div>
        </div>
        <div class="row mt-3 justify-content-center">
          <div class="col-6 text-center">
            <button class="btn btn-primary" onclick="onClickFind()">조회</button>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>
{% endblock %}

{% block javascript %}
<script>
  // 전화번호 입력방식
  function autoHypenTel(str) {
    str = str.replace(/[^0-9]/g, '');
    var tmp = '';

    if (str.substring(0, 2) == 02) {
      // 서울 전화번호일 경우 10자리까지만 나타나고 그 이상의 자리수는 자동삭제
      if (str.length < 3) {
        return str;
      } else if (str.length < 6) {
        tmp += str.substr(0, 2);
        tmp += '-';
        tmp += str.substr(2);
        return tmp;
      } else if (str.length < 10) {
        tmp += str.substr(0, 2);
        tmp += '-';
        tmp += str.substr(2, 3);
        tmp += '-';
        tmp += str.substr(5);
        return tmp;
      } else {
        tmp += str.substr(0, 2);
        tmp += '-';
        tmp += str.substr(2, 4);
        tmp += '-';
        tmp += str.substr(6, 4);
        return tmp;
      }
    } else {
      // 핸드폰 및 다른 지역 전화번호 일 경우
      if (str.length < 4) {
        return str;
      } else if (str.length < 7) {
        tmp += str.substr(0, 3);
        tmp += '-';
        tmp += str.substr(3);
        return tmp;
      } else if (str.length < 11) {
        tmp += str.substr(0, 3);
        tmp += '-';
        tmp += str.substr(3, 3);
        tmp += '-';
        tmp += str.substr(6);
        return tmp;
      } else {
        tmp += str.substr(0, 3);
        tmp += '-';
        tmp += str.substr(3, 4);
        tmp += '-';
        tmp += str.substr(7);
        return tmp;
      }
    }

    return str;
  };

  $('#call').keyup(function (event) {
    event = event || window.event;
    var _val = this.value.trim();
    this.value = autoHypenTel(_val);
  });

  const onClickFind = () => {
    const name = $('#name').val();
    const call = $('#call').val();
    if (name === '') {
      Swal.fire({
        icon: 'error',
        title: '성명 미입력',
        text: '성명을 입력해주세요!',
      })
      return;
    }
    if (call === '') {
      Swal.fire({
        icon: 'error',
        title: '전화번호 미입력',
        text: '전화번호를 입력해주세요!',
      })
      return;
    }
    $.ajax({
      url: "{% url 'user:find_id' %}",
      type: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}'
      },
      data: {
        name,
        call,
      },
      success: (data) => {
        if (data.result === 'success') {
          Swal.fire({
            title: '아이디는 ' + data.id + ' 입니다.',
            showCancelButton: true,
            confirmButtonText: '비밀번호 재설정',
            cancelButtonText: '닫기',
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = "{% url 'user:reset_pwd' %}";
            }
          })
        } else {
          Swal.fire({
            icon: 'error',
            title: '아이디 찾기 실패',
            text: '가입된 아이디가 없습니다.',
          })
        }
      },
      error: (err) => {
        console.log(err);
      },
    });
  };
</script>
{% endblock %}